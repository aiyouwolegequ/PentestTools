#!/bin/bash
clear
echo "#######################################################################"
echo ""
echo "开始安装渗透工具"
echo ""
echo "#######################################################################"
echo "请耐心等待！"
LANG="en_US.UTF-8"

cat > /etc/profile<<-EOF
export PATH=/bin:/sbin:/usr/bin:/usr/sbin:/usr/local/bin:/usr/local/sbin:~/bin
export LC_ALL=en_US.UTF-8
EOF

source /etc/profile
rm -rf /var/run/yum.pid
yum clean all -q

if [ ! -f "/etc/yum.conf.bak" ]; then
	cp /etc/yum.conf /etc/yum.conf.bak
	echo "minrate=1" >> /etc/yum.conf
	echo "timeout=300" >> /etc/yum.conf
fi

if [ ! -f "/etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release" ];then
		wget -q https://raw.githubusercontent.com/aiyouwolegequ/AutoBoom/master/booooom/RPM-GPG-KEY-redhat-release -O /etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release
		rpm --quiet --import /etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release
fi

rpm --quiet --import /etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7
yum groupinstall "Development Tools" -q -y

if [ ! -f "/etc/pki/rpm-gpg/RPM-GPG-KEY-elrepo.org" ];then
	rpm --quiet --import https://www.elrepo.org/RPM-GPG-KEY-elrepo.org
	rpm --quiet -Uvh http://www.elrepo.org/elrepo-release-7.0-3.el7.elrepo.noarch.rpm
fi

yum-complete-transaction --cleanup-only -q
yum history redo last -q

for a in epel-release yum-plugin-fastestmirror yum-utils deltarpm
do
	if [ `rpm -qa | grep $a | wc -l` -eq 0 ];then
		yum install $a -q -y
	fi
done

for a in mirrorlist metalink
do
	while [ `rpm -qa |grep epel-release | wc -l` -eq 1 ] && [ `cat /etc/yum.repos.d/epel.repo | grep "$a" | wc -l` -ne 0 ]
    do
		sed -i "s/^#baseurl/baseurl/g" /etc/yum.repos.d/epel.repo
		sed -i 's/^'${a}'/#'${a}'/g' /etc/yum.repos.d/epel.repo
		break
	done
done

yum install asciidoc autoconf automake bind-utils bzip2 bzip2-devel c-ares-devel curl finger gawk gcc gcc-c++ gettext git glibc-static iproute libcurl-devel libev-devel libevent-devel libffi-devel libstdc++-static libtool libtool-ltdl-devel lsof m2crypto make mlocate ncurses-devel net-tools openssl-devel patch pcre-devel policycoreutils-python ppp psmisc python-devel python-pip python-setuptools python34 python34-devel readline readline-devel ruby ruby-dev rubygems sqlite-devel swig sysstat tar tk-devel tree unzip vim wget xmlto zlib zlib-devel -q -y
ldconfig
wget -q https://bootstrap.pypa.io/get-pip.py
python get-pip.py
python3 get-pip.py
python -m pip install -U pip -q
python -m pip install -U distribute -q
python3 -m pip install --upgrade pip -q
python -m pip install pycurl pygments dnspython gevent wafw00f censys selenium BeautifulSoup4 json2html tabulate configparser parse wfuzz feedparser greenlet -q
python3 -m pip install scrapy docopt twisted lxml parsel w3lib cryptography pyopenssl anubis-netsec plecost json2html tabulate -q
easy_install -q shodan
asy_install -q supervisor
updatedb
locate inittab
rm -rf get-pip.py

if [ ! -f "/usr/local/lib/libsodium.so" ];then
	wget -q --tries=3 -O libsodium.tar.gz https://download.libsodium.org/libsodium/releases/LATEST.tar.gz
	tar zxvf libsodium.tar.gz
	pushd libsodium-stable
	./configure
	make && make install
	popd
	echo /usr/local/lib > /etc/ld.so.conf.d/usr_local_lib.conf
	ldconfig
fi

if [ ! -d "/usr/include/mbedtls" ];then
	wget -q --tries=3 https://tls.mbed.org/download/mbedtls-2.6.0-gpl.tgz
	tar xvf mbedtls-2.6.0-gpl.tgz
	pushd mbedtls-2.6.0
	make SHARED=1 CFLAGS=-fPIC
	make DESTDIR=/usr install
	popd
	ldconfig
fi

if [ ! -f "/usr/local/lib/libevent.so" ];then
	wget -q --tries=3 https://github.com/libevent/libevent/releases/download/release-2.1.8-stable/libevent-2.1.8-stable.tar.gz
	tar zxvf libevent-2.1.8-stable.tar.gz
	pushd libevent-2.1.8-stable
	./configure
	make && make install
	popd
	ldconfig
fi

rm -rf libsodium* mbedtls* libevent*
git clone -q https://github.com/lijiejie/subDomainsBrute.git /usr/src/pentest/subDomainsBrute
git clone -q https://github.com/urbanadventurer/WhatWeb.git /usr/src/pentest/WhatWeb
git clone -q https://github.com/gelim/censys.git /usr/src/pentest/censys
git clone -q https://github.com/Xyntax/FileSensor /usr/src/pentest/FileSensor
git clone -q https://github.com/Xyntax/BingC.git /usr/src/pentest/BingC
git clone -q https://github.com/TheRook/subbrute.git /usr/src/pentest/subbrute
git clone -q https://github.com/n4xh4ck5/N4xD0rk.git /usr/src/pentest/N4xD0rk
git clone -q https://github.com/TheRook/subbrute.git /usr/src/pentest/subbrute
git clone -q https://github.com/n4xh4ck5/N4xD0rk.git /usr/src/pentest/N4xD0rk
git clone -q https://github.com/maurosoria/dirsearch.git /usr/src/pentest/dirsearch
git clone -q https://github.com/stanislav-web/OpenDoor.git /usr/src/pentest/OpenDoor
git clone -q https://github.com/ekultek/whatwaf.git /usr/src/pentest/whatwaf
git clone -q https://github.com/aboul3la/Sublist3r.git /usr/src/pentest/Sublist3r
git clone -q https://github.com/laramies/theHarvester.git /usr/src/pentest/theHarvester
git clone -q https://github.com/appsecco/bugcrowd-levelup-subdomain-enumeration.git /usr/src/pentest/bugcrowd
git clone -q https://github.com/darkoperator/dnsrecon /usr/src/pentest/dnsrecon
git clone -q --depth 1 https://github.com/sqlmapproject/sqlmap.git sqlmap-dev /usr/src/pentest/sqlmap-dev

cat >> /root/.zshrc<<-EOF
alias theharvester="python /usr/src/pentest/theHarvester/theHarvester.py -b all -l 1000 -h -d"
alias subDomainsBrute="python /usr/src/pentest/subDomainsBrute/subDomainsBrute.py"
alias censys="python /usr/src/pentest/censys/censys_io.py"
alias censys="python /usr/src/pentest/censys/censys_io.py"
alias filesensor="python3 /usr/src/pentest/FileSensor/filesensor.py"
alias bingc="python /usr/src/pentest/BingC/bingC.py"
alias reverseip="python /usr/src/pentest/ReverseIP/reverseip.py"
alias sqlmap="python /usr/src/pentest/sqlmap-dev/sqlmap.py"
alias cdnfinder="docker run -it turbobytes/cdnfinder cdnfindercli --phantomjsbin="/bin/phantomjs" --host"
alias subdns="python /usr/src/pentest/subbrute/subbrute.py -p"
alias sublist3r="python /usr/src/pentest/Sublist3r/sublist3r.py -v -d"
alias n4xd0rk="python /usr/src/pentest/N4xD0rk/n4xd0rk.py -n 100 -t"
alias anubis="anubis -t -ip --with-nmap -r -d"
alias whatweb="ruby /usr/src/pentest/WhatWeb/whatweb -v"
alias dirsearch="python3  /usr/src/pentest/dirsearch/dirsearch.py -u"
alias wafw00f="wafw00f -r -a -v"
alias theharvester="python /usr/src/pentest/theHarvester/theHarvester.py"
alias dnsrecon="python3 /usr/src/pentest/dnsrecon/dnsrecon.py -D /usr/src/pentest/dnsrecon/subdomains-top1mil-20000.txt -t brt"
EOF

source /root/.zshrc
clear
echo "#######################################################################"
echo ""
echo "安装完毕！工具路径为/usr/src/pentest/"
echo ""
echo "#######################################################################"
echo ""
exit